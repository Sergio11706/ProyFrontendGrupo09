<div class="container my-5">
  <h2 class="section-title text-center mb-4">üí≥ Finalizar Compra</h2>

  <div class="row">
    <!-- Formulario de Checkout -->
    <div class="col-lg-8">
      <div class="card shadow p-4 rounded-4 checkout-card">
        <h4 class="mb-4">üìã Informaci√≥n de Contacto</h4>
        
        <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="nombre" class="form-label fw-semibold">Nombre completo *</label>
              <input id="nombre"
                     type="text"
                     class="form-control form-control-lg"
                     [class.is-invalid]="checkoutForm.get('nombre')?.invalid && checkoutForm.get('nombre')?.touched"
                     formControlName="nombre"
                     placeholder="Tu nombre completo">
              <div class="invalid-feedback" *ngIf="getErrorMessage('nombre')">
                {{ getErrorMessage('nombre') }}
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="email" class="form-label fw-semibold">Email *</label>
              <input id="email"
                     type="email"
                     class="form-control form-control-lg"
                     [class.is-invalid]="checkoutForm.get('email')?.invalid && checkoutForm.get('email')?.touched"
                     formControlName="email"
                     placeholder="tu@email.com">
              <div class="invalid-feedback" *ngIf="getErrorMessage('email')">
                {{ getErrorMessage('email') }}
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="telefono" class="form-label fw-semibold">Tel√©fono *</label>
              <input id="telefono"
                     type="tel"
                     class="form-control form-control-lg"
                     [class.is-invalid]="checkoutForm.get('telefono')?.invalid && checkoutForm.get('telefono')?.touched"
                     formControlName="telefono"
                     placeholder="11 1234-5678">
              <div class="invalid-feedback" *ngIf="getErrorMessage('telefono')">
                {{ getErrorMessage('telefono') }}
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="codigoPostal" class="form-label fw-semibold">C√≥digo Postal *</label>
              <input id="codigoPostal"
                     type="text"
                     class="form-control form-control-lg"
                     [class.is-invalid]="checkoutForm.get('codigoPostal')?.invalid && checkoutForm.get('codigoPostal')?.touched"
                     formControlName="codigoPostal"
                     placeholder="1234">
              <div class="invalid-feedback" *ngIf="getErrorMessage('codigoPostal')">
                {{ getErrorMessage('codigoPostal') }}
              </div>
            </div>
          </div>

          <div class="mb-4">
            <label for="direccion" class="form-label fw-semibold">Direcci√≥n de entrega *</label>
            <textarea id="direccion"
                      class="form-control form-control-lg"
                      [class.is-invalid]="checkoutForm.get('direccion')?.invalid && checkoutForm.get('direccion')?.touched"
                      formControlName="direccion"
                      rows="3"
                      placeholder="Calle, n√∫mero, piso, departamento, barrio"></textarea>
            <div class="invalid-feedback" *ngIf="getErrorMessage('direccion')">
              {{ getErrorMessage('direccion') }}
            </div>
          </div>

          <div class="alert alert-info" role="alert">
            <strong>üí≥ M√©todo de Pago:</strong> Mercado Pago
            <br>
            <small class="text-muted">Aceptamos todas las tarjetas, transferencias y efectivo a trav√©s de Mercado Pago</small>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <button type="button" class="btn btn-outline-secondary" (click)="volverAlCarrito()">
              ‚Üê Volver al Carrito
            </button>
            <button type="submit" 
                    class="btn btn-primary btn-lg" 
                    [disabled]="loading || checkoutForm.invalid">
              <span *ngIf="!loading">üí≥ Proceder al Pago</span>
              <span *ngIf="loading">‚è≥ Procesando...</span>
            </button>
          </div>

          <div class="alert alert-danger mt-3" *ngIf="errorMessage" role="alert">
            {{ errorMessage }}
          </div>
        </form>
      </div>
    </div>

    <!-- Resumen del Pedido -->
    <div class="col-lg-4">
      <div class="card shadow p-4 rounded-4 checkout-summary">
        <h4 class="mb-4">üõí Resumen del Pedido</h4>
        
        <div class="order-items">
          <div class="order-item" *ngFor="let item of items">
            <div class="item-info">
              <h6 class="item-name">{{ item.nombre }}</h6>
              <small class="text-muted">{{ item.componentes?.join(', ') }}</small>
            </div>
            <div class="item-quantity">
              <span class="badge bg-secondary">{{ item.cantidad || 1 }}x</span>
            </div>
            <div class="item-price">
              {{ (item.precio || 0) * (item.cantidad || 1) | currency:'ARS' }}
            </div>
          </div>
        </div>

        <hr>

        <div class="order-total">
          <div class="d-flex justify-content-between">
            <span>Subtotal:</span>
            <span>{{ total | currency:'ARS' }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Env√≠o:</span>
            <span class="text-success">Gratis</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold fs-5">
            <span>Total:</span>
            <span class="text-primary">{{ total | currency:'ARS' }}</span>
          </div>
        </div>

        <div class="payment-info mt-3">
          <div class="alert alert-success" role="alert">
            <strong>‚úÖ Pago Seguro</strong>
            <br>
            <small>Tus datos est√°n protegidos por Mercado Pago</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
