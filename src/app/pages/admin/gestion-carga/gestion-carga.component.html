<div class="container mt-4">
  <h3>Cargar nuevo producto</h3>
  <form (ngSubmit)="guardarProducto()">
    <div class="row g-3">
      <div class="col-md-6">
        <label>Nombre</label>
        <input 
          class="form-control" 
          [(ngModel)]="bebida.nombre" 
          [(ngModel)]="ingrediente.nombre" 
          name="nombre" 
          required 
          minlength="2"
          maxlength="50"
          pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$"
          #nombre="ngModel" />
        <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="text-danger small mt-1">
          <div *ngIf="nombre.errors?.['required']">El nombre es requerido</div>
          <div *ngIf="nombre.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</div>
          <div *ngIf="nombre.errors?.['maxlength']">El nombre no puede tener más de 50 caracteres</div>
          <div *ngIf="nombre.errors?.['pattern']">Solo se permiten letras y espacios</div>
        </div>
      </div>
      <div class="col-md-6">
        <label>Unidad de medida</label>
        <input 
          class="form-control" 
          [(ngModel)]="bebida.unidadMedida" 
          [(ngModel)]="ingrediente.unidadMedida" 
          name="unidadMedida" 
          required 
          minlength="1"
          maxlength="20"
          #unidadMedida="ngModel" />
        <div *ngIf="unidadMedida.invalid && (unidadMedida.dirty || unidadMedida.touched)" class="text-danger small mt-1">
          <div *ngIf="unidadMedida.errors?.['required']">La unidad de medida es requerida</div>
          <div *ngIf="unidadMedida.errors?.['minlength']">La unidad de medida debe tener al menos 1 caracter</div>
          <div *ngIf="unidadMedida.errors?.['maxlength']">La unidad de medida no puede tener más de 20 caracteres</div>
        </div>
      </div>
      <div class="col-md-6">
        <label>Stock</label>
        <input 
          type="number" 
          class="form-control" 
          [(ngModel)]="bebida.stock" 
          [(ngModel)]="ingrediente.stock" 
          name="stock" 
          required 
          min="0"
          max="9999"
          #stock="ngModel" />
        <div *ngIf="stock.invalid && (stock.dirty || stock.touched)" class="text-danger small mt-1">
          <div *ngIf="stock.errors?.['required']">El stock es requerido</div>
          <div *ngIf="stock.errors?.['min']">El stock no puede ser negativo</div>
          <div *ngIf="stock.errors?.['max']">El stock no puede ser mayor a 9999</div>
        </div>
      </div>
      <div class="col-md-6">
        <label>Precio unitario</label>
        <input 
          type="number" 
          class="form-control" 
          [(ngModel)]="bebida.precioUnitario" 
          [(ngModel)]="ingrediente.precioUnitario" 
          name="precioUnitario" 
          required 
          min="0.01"
          max="999999"
          step="0.01"
          #precioUnitario="ngModel" />
        <div *ngIf="precioUnitario.invalid && (precioUnitario.dirty || precioUnitario.touched)" class="text-danger small mt-1">
          <div *ngIf="precioUnitario.errors?.['required']">El precio unitario es requerido</div>
          <div *ngIf="precioUnitario.errors?.['min']">El precio debe ser mayor a 0</div>
          <div *ngIf="precioUnitario.errors?.['max']">El precio no puede ser mayor a 999999</div>
        </div>
      </div>
      <div class="col-md-6">
        <label>Vencimiento</label>
        <input 
          type="date" 
          class="form-control" 
          [(ngModel)]="bebida.vencimiento" 
          [(ngModel)]="ingrediente.vencimiento" 
          name="vencimiento" 
          required 
          #vencimiento="ngModel" />
        <div *ngIf="vencimiento.invalid && (vencimiento.dirty || vencimiento.touched)" class="text-danger small mt-1">
          <div *ngIf="vencimiento.errors?.['required']">La fecha de vencimiento es requerida</div>
        </div>
      </div>
      <!-- Imagen -->
    <div class="col-md-6">
      <label>Imagen</label>
      <input class="form-control" [(ngModel)]="bebida.imagen" [(ngModel)]="ingrediente.imagen" name="imagen" #imagenCtrl="ngModel" required pattern="https?://.+"/>
      <div *ngIf="imagenCtrl.invalid && (imagenCtrl.dirty || imagenCtrl.touched)" class="text-danger small mt-1"> 
        <div *ngIf="imagenCtrl.errors?.['required']">La imagen es obligatoria.</div> 
        <div *ngIf="imagenCtrl.errors?.['pattern']">Debe ser una URL válida (que comience con http:// o https://).</div>
      </div>
    </div>

    <!-- Tipo de producto -->
    <div class="col-md-6">
      <label>Tipo de producto</label>
      <select
        class="form-select"
        [(ngModel)]="tipoProducto"
        name="tipoProducto"
        #tipoProductoCtrl="ngModel"
        required
      >
        <option value="">Seleccionar tipo de producto</option>
        <option value="Bebida">Bebida</option> 
        <option value="Ingrediente">Ingrediente</option>
      </select>
      <div *ngIf="tipoProductoCtrl.invalid && (tipoProductoCtrl.dirty || tipoProductoCtrl.touched)" class="text-danger">
        <div *ngIf="tipoProductoCtrl.errors?.['required']">Debe seleccionar un tipo de producto.</div>
      </div>
    </div>

    <!-- Solo si es bebida -->
    <div class="col-md-6" *ngIf="tipoProducto === 'Bebida'">
      <label>Volumen (ml)</label>
      <input
        type="number"
        class="form-control"
        [(ngModel)]="bebida.volumen"
        name="volumen"
        min="1" required
        #volumenCtrl="ngModel"
      />
       <div *ngIf="volumenCtrl.invalid && (volumenCtrl.dirty || volumenCtrl.touched)" class="text-danger small mt-1">
        <div *ngIf="volumenCtrl.errors?.['required']">El tipo de volumen es obligatorio.</div>
      </div>

      <label>Tipo de bebida</label>
      <input
        class="form-control"
        [(ngModel)]="bebida.tipoBebida"
        name="tipoBebida"
        required
        #tipoBebidaCtrl="ngModel"
      />
      <div *ngIf="tipoBebidaCtrl.invalid && (tipoBebidaCtrl.dirty || tipoBebidaCtrl.touched)" class="text-danger small mt-1">
        <div *ngIf="tipoBebidaCtrl.errors?.['required']">El tipo de bebida es obligatorio.</div>
      </div>
    </div>

    <!-- Solo si es ingrediente -->
    <div class="col-md-6" *ngIf="tipoProducto === 'Ingrediente'">
      <label>Categoría</label>
      <input
        class="form-control"
        [(ngModel)]="ingrediente.categoria"
        name="categoria" required
        #categoriaCtrl="ngModel"
      />
       <div *ngIf="categoriaCtrl.invalid && (categoriaCtrl.dirty || categoriaCtrl.touched)" class="text-danger small mt-1">
        <div *ngIf="categoriaCtrl.errors?.['required']">El tipo de categoria es obligatorio.</div>
      </div>
      <label>Proveedor</label>
      <input
        class="form-control"
        [(ngModel)]="ingrediente.proveedor"
        name="proveedor"
        required
        #proveedorCtrl="ngModel"
      />
       <div *ngIf="proveedorCtrl.invalid && (proveedorCtrl.dirty || proveedorCtrl.touched)" class="text-danger small mt-1">
        <div *ngIf="proveedorCtrl.errors?.['required']">El tipo de proveedor es obligatorio.</div>
      </div>
    </div>
  </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-success">Guardar producto</button>
    </div>
  </form>

  <hr />

  <hr>
    <h3>Cargar Pedido Pre-Cargado</h3>
<form (ngSubmit)="crearPedido()" #pedidoForm="ngForm">

  <!-- Campo Nombre (ya estaba con validaciones) -->
  <div class="mb-3">
    <label>Nombre</label>
    <input 
      class="form-control" 
      [(ngModel)]="pedido.nombre" 
      name="nombre" 
      required 
      minlength="2"
      maxlength="50"
      pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$"
      #nombre="ngModel" />
    
    <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="text-danger small mt-1">
      <div *ngIf="nombre.errors?.['required']">El nombre es requerido</div>
      <div *ngIf="nombre.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</div>
      <div *ngIf="nombre.errors?.['maxlength']">El nombre no puede tener más de 50 caracteres</div>
      <div *ngIf="nombre.errors?.['pattern']">Solo se permiten letras y espacios</div>
    </div>
  </div>

  <!-- Campo Imagen -->
  <div class="mb-3">
    <label>Imagen</label>
    <input 
      class="form-control" 
      type="text" 
      [(ngModel)]="pedido.imagen" 
      name="imagen" 
      required 
      pattern="https?://.*"
      #imagen="ngModel" />
    
    <div *ngIf="imagen.invalid && (imagen.dirty || imagen.touched)" class="text-danger small mt-1">
      <div *ngIf="imagen.errors?.['required']">La URL de la imagen es requerida</div>
      <div *ngIf="imagen.errors?.['pattern']">Debe ingresar una URL válida que comience con http:// o https://</div>
    </div>
  </div>

  <div class="mb-3">
    <label>Cantidad</label>
    <select 
      class="form-select" 
      [(ngModel)]="cantidad" 
      name="cantidad" 
      required 
      #cantidadCtrl="ngModel" 
      (change)="actualizarCantidad()">
      <option value="">Seleccionar cantidad</option>
      <option *ngFor="let n of [1,2,3,4,5,6,7,8,9,10]" [value]="n">{{ n }}</option>
    </select>
    
    <div *ngIf="cantidadCtrl.invalid && (cantidadCtrl.dirty || cantidadCtrl.touched)" class="text-danger small mt-1">
      <div *ngIf="cantidadCtrl.errors?.['required']">Debe seleccionar una cantidad</div>
    </div>
  </div>

  <div class="mb-3">
    <ng-container *ngFor="let index of arrayAuxiliar; let i = index">
      <label>Producto</label>
      <select 
        class="form-select" 
        [(ngModel)]="pedido.productos![i]" 
        [name]="'producto' + index" 
        required 
        #productoCtrl="ngModel">
        <option value="">Seleccionar producto</option>
        <option *ngFor="let producto of productos" [ngValue]="producto">{{ producto.nombre }}</option>
      </select>

      <div *ngIf="productoCtrl.invalid && (productoCtrl.dirty || productoCtrl.touched)" class="text-danger small mt-1">
        <div *ngIf="productoCtrl.errors?.['required']">Debe seleccionar un producto</div>
      </div>
    </ng-container>
  </div>




        <button type="submit" class="btn btn-primary" [disabled]="!pedidoForm.form.valid">Crear Pedido</button>
      </form>
</div>
